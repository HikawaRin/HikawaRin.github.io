<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hikawarin.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="In this post, I will introduce the red black tree, which is a kind of self-balancing binary search tree. Red black tree has more relaxed notion of balance than AVL trees, which is good enough to red">
<meta property="og:type" content="article">
<meta property="og:title" content="Red Black Tree">
<meta property="og:url" content="http://hikawarin.github.io/2022/07/21/Red-Black-Tree/index.html">
<meta property="og:site_name" content="Blue Period">
<meta property="og:description" content="In this post, I will introduce the red black tree, which is a kind of self-balancing binary search tree. Red black tree has more relaxed notion of balance than AVL trees, which is good enough to red">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/bst_zig.svg">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/2-3-4_tree.gif">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/rotate.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/corresponde.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/fix_insert_1.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/fix_insert_2.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/rbt_insert.gif">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/delete_preparation.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/fix_delete_1.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/fix_delete_2.png">
<meta property="og:image" content="http://hikawarin.github.io/images/Red_Black_Tree/delete_demo.png">
<meta property="article:published_time" content="2022-07-21T23:11:36.000Z">
<meta property="article:modified_time" content="2022-07-28T07:18:13.276Z">
<meta property="article:author" content="Hikawa Rin">
<meta property="article:tag" content="Data Structure">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hikawarin.github.io/images/Red_Black_Tree/bst_zig.svg">


<link rel="canonical" href="http://hikawarin.github.io/2022/07/21/Red-Black-Tree/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://hikawarin.github.io/2022/07/21/Red-Black-Tree/","path":"2022/07/21/Red-Black-Tree/","title":"Red Black Tree"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Red Black Tree | Blue Period</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Blue Period</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Personal blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">3</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">4</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">3</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#self-balanced-tree"><span class="nav-number">1.</span> <span class="nav-text">Self-Balanced Tree</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#why-we-need-balanced-tree"><span class="nav-number">1.1.</span> <span class="nav-text">Why we need balanced tree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tree"><span class="nav-number">1.2.</span> <span class="nav-text">2-3-4 Tree</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#definition"><span class="nav-number">2.</span> <span class="nav-text">Definition</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#operation"><span class="nav-number">3.</span> <span class="nav-text">Operation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rotation"><span class="nav-number">3.1.</span> <span class="nav-text">Rotation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#insert"><span class="nav-number">3.2.</span> <span class="nav-text">Insert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#delete"><span class="nav-number">3.3.</span> <span class="nav-text">Delete</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hikawa Rin"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Hikawa Rin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/HikawaRin" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://hikawarin.github.io/2022/07/21/Red-Black-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Hikawa Rin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blue Period">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Red Black Tree | Blue Period">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Red Black Tree
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-21 23:11:36" itemprop="dateCreated datePublished" datetime="2022-07-21T23:11:36+00:00">2022-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-28 07:18:13" itemprop="dateModified" datetime="2022-07-28T07:18:13+00:00">2022-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Data-Structure/" itemprop="url" rel="index"><span itemprop="name">Data Structure</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Data-Structure/Binary-Search-Tree-Balance-Tree/" itemprop="url" rel="index"><span itemprop="name">Binary Search Tree & Balance Tree</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>4 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>  In this post, I will introduce the red black tree, which is a kind of self-balancing binary search tree. Red black tree has more relaxed notion of balance than AVL trees, which is good enough to reduce the searching time and more easy to maintain the tree itself. Since red black tree is also a BST, so some tricky operation I introduction in <a href="https://hikawarin.github.io/2022/07/18/Binary-Search-Tree">this post</a> also works in red black tree. <span id="more"></span></p>
<h2 id="self-balanced-tree">Self-Balanced Tree</h2>
<h3 id="why-we-need-balanced-tree">Why we need balanced tree</h3>
<p>  Binary Search Tree is good, but BST may degenerate to a linked list while handling some kinds of input, in this case the time complex of BST operation would increase to <span class="math inline">\(O(N)\)</span>.<br />
Let`s say, we insert array <code>[1, 10, 2, 9, 3, 8, 4, 7, 5, 6]</code> to BST, after insertion the BST would look like below:<br />
<img src="/images/Red_Black_Tree/bst_zig.svg" alt="zig-zag-bst" /> BST also badly handle sequence or reverse input data, which is not a rare scenario.<br />
  So, to get the best performance we want to get a full tree, whatever our input are. In this case, any node`s left subtree should obtain the same number of node as the right subtree, which is a balanced tree.</p>
<h3 id="tree">2-3-4 Tree</h3>
<p>A 2-3-4 Tree is a self-balancing tree, it allowed internal node obtain more than two child node. There are three type of internal node in 2-3-4 tree, which obtain 2/3/4 child node and the key in one node sorted from smallest to greatest, that`s where it`s name come from.<br />
  2-3-4 Tree has a special way to insert key, which makes it self-balance. Every time insert a new key to 2-3-4 tree, it first find a leaf node with the same process of BST, if the leaf node is full, which means it obtain 3 key already, split it to two node to store the smallest and greatest key, then insert the mid key to it`s parent, recurse the above process until find a not empty node store mid key or reach the root, the root node will split into three node and the mid key would be the new root. Finaly insert the key to the right leaf.<br />
Here a demo for input above: <img src="/images/Red_Black_Tree/2-3-4_tree.gif" alt="2-3-4-insert" /></p>
<p>Notice that 2-3-4 tree kept balance in insert process. If we could do similar operation in BST, we would avoid the degenerate, and that`s what red black tree do.</p>
<h2 id="definition">Definition</h2>
<p>A red-black tree is a binary search tree with the following additional properties:<br />
1. Every node is either red or black.<br />
2. Each NULL pointer is considered to be a black node.<br />
3. If a node is red, then <strong>both</strong> of its children are black.<br />
4. Every path from a node to a leaf contains the same number of black nodes. A red-black tree of <span class="math inline">\(n\)</span> nodes, then the height <span class="math inline">\(h &lt;= 2lg(n+1)\)</span>.</p>
<h2 id="operation">Operation</h2>
<p>At this post we will talk about the <strong><em>bottom-up</em></strong> insert and delete. the complet implementation code in <a target="_blank" rel="noopener" href="https://github.com/HikawaRin/data_structure/blob/master/binary_search_tree_and_balanced_tree/red_black_tree.cc">here</a></p>
<h3 id="rotation">Rotation</h3>
<p>a red-black tree balance itselft according to rotation. Basically, there are two type of rotate: left rotate(zig), right rotate(zag), each is inverse to the other. <img src="/images/Red_Black_Tree/rotate.png" alt="rotate" /></p>
<h3 id="insert">Insert</h3>
<p>If we treat the edge between red node and it`s parent as glue, then we can correspond red-black tree node to 2-3-4 tree node just like below: <img src="/images/Red_Black_Tree/corresponde.png" alt="node relation" /> Remenber that a red node`s child must be black, which means there are no continued red node in red-black tree , so the 4 node is injective.<br />
With this correspond table in mind, we could start insert.<br />
First, we insert the key into red-black tree just like BST but paint that new insert node with color red, which could be seen as glue that node into the leaf node, just like 2-3-4 tree does.<br />
Then we must check if the red node is legal if the node is not root:</p>
<ul>
<li>Case 1: if the parent is black we are just change a 2 node to a 3 node, no action needed and we are done.<br />
</li>
<li>if the parent is red, we need check the color of the sib of parent, which we called it uncle node:
<ul>
<li>Case 2: if the uncle is black, we are change a 3 node to a 4 node, which is legal in 2-3-4 tree, but violate the red-black tree rule 3, and we can fix it with rotation:
<ul>
<li>if node is in the opposite position compare to parent related to grandparent, we must first rotate parent to fix it.</li>
<li>if node and parent is in the same direction we rotate the grandparent to the opposite of parent fixed the continue red violate.<br />
<img src="/images/Red_Black_Tree/fix_insert_1.png" alt="fix insert case 1" /></li>
</ul></li>
<li>Case 3: if the uncle is red, then the leaf node is already a 4 node, and should slipt, in red-black tree we just need to flip the color of parent, uncle and grandparent, since we are paint grandparent red, it must be checked as well.<br />
<img src="/images/Red_Black_Tree/fix_insert_2.png" alt="fix insert case 2" /></li>
</ul></li>
</ul>
<p>Finaly color root with black, and the insert is finished.<br />
Notice that we only rotate in Case 2 and after rotate we are done, so there are <strong>at most two rotation</strong> every insert.<br />
Though the picture above only shows the left case, the right case is just symmetric opration.<br />
Here`s the demo for zig input: <img src="/images/Red_Black_Tree/rbt_insert.gif" alt="rbt insert" /></p>
<h3 id="delete">Delete</h3>
<p>With the same idea of insert, we can assume that before delete our red-black tree is balanced, at least balanced as 2-3-4 tree does.<br />
So we only need to keep balance in delete. The key idea is that we change some node from red to balck, that would increase one height. Here`s the step:</p>
<p>First find out the node should be delete by query key.<br />
Then, check color of the node and it`s replace node and delete the target node, if either node is red, which means we are delete from a 3/4 node, color the replace node black and we are done. if both node is black, then the height of correspond 2-3-4 tree is broken and we need fix it with rotation:</p>
<ul>
<li>Preparation: If the sibling of replace node is red, we rotate parent to the replace node and update sibling information.<br />
<img src="/images/Red_Black_Tree/delete_preparation.png" alt="delete preparation" /></li>
<li>Case 1: If both child of sibling is black, we color sibling red, and check parent color:
<ul>
<li>If parent is red, color parent black and we are done.</li>
<li>If parent is already balck, we must fix parent now. <img src="/images/Red_Black_Tree/fix_delete_1.png" alt="delete case 1" /></li>
</ul></li>
<li>Case 2: At least one sibling child is red:
<ul>
<li>If the red child is in opposite position, we rotate it to the sequence position first.<br />
</li>
<li>the we rotate parent to the replace node direction and color the red chlid black and we are done.<br />
<img src="/images/Red_Black_Tree/fix_delete_2.png" alt="delete case 2" /></li>
</ul></li>
</ul>
<p>Notice that in case 2 we rotate at most twice and finish, though at the preparation we may rotate once, but that rotate guarantee we would end at parent, since it`s red now. So there are <strong>at most three rotation</strong> every delete. The picture only shows the left case, the right case is just summetric operation. Here`s the demo of delet: <img src="/images/Red_Black_Tree/delete_demo.png" alt="delete demo" /></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Data-Structure/" rel="tag"># Data Structure</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/07/18/Binary-Search-Tree/" rel="prev" title="Binary Search Tree">
                  <i class="fa fa-chevron-left"></i> Binary Search Tree
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hikawa Rin</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>Symbols count total: </span>
    <span title="Symbols count total">13k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>Reading time total &asymp;</span>
    <span title="Reading time total">9 mins.</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
